<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.8.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="alternate" href="/atom.xml" title="Deepspace" type="application/atom+xml"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"7.5.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"复制",copy_success:"复制成功",copy_failure:"复制失败"},sidebarPadding:40}</script><meta name="description" content="Express 是一个基于 Node.js 平台的极简、灵活的 web 应用开发框架，它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用，实现对数据库的增删查改。 数据库我们选择 MongoDB，它是一个基于分布式文件存储的开源数据库系统，Mongoose 是在 node.js 异步环境下对 mongodb 进行便捷操作的对象模型工具 。 接下来我们使用 Express + Mong"><meta name="keywords" content="Express,Mongoose"><meta property="og:type" content="article"><meta property="og:title" content="Express + Mongoose 实现增删改查"><meta property="og:url" content="https://togoblog.cn/express-mongoose/index.html"><meta property="og:site_name" content="Deepspace"><meta property="og:description" content="Express 是一个基于 Node.js 平台的极简、灵活的 web 应用开发框架，它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用，实现对数据库的增删查改。 数据库我们选择 MongoDB，它是一个基于分布式文件存储的开源数据库系统，Mongoose 是在 node.js 异步环境下对 mongodb 进行便捷操作的对象模型工具 。 接下来我们使用 Express + Mong"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://raw.githubusercontent.com/IDeepspace/ImageHosting/master/NodeJS/express-2.png"><meta property="og:image" content="https://raw.githubusercontent.com/IDeepspace/ImageHosting/master/NodeJS/Schema-Types.png"><meta property="og:updated_time" content="2019-11-07T09:31:58.259Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Express + Mongoose 实现增删改查"><meta name="twitter:description" content="Express 是一个基于 Node.js 平台的极简、灵活的 web 应用开发框架，它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用，实现对数据库的增删查改。 数据库我们选择 MongoDB，它是一个基于分布式文件存储的开源数据库系统，Mongoose 是在 node.js 异步环境下对 mongodb 进行便捷操作的对象模型工具 。 接下来我们使用 Express + Mong"><meta name="twitter:image" content="https://raw.githubusercontent.com/IDeepspace/ImageHosting/master/NodeJS/express-2.png"><link rel="canonical" href="https://togoblog.cn/express-mongoose/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>Express + Mongoose 实现增删改查 | Deepspace</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Deepspace</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">我叫陈星星</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li></ul></nav></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://togoblog.cn/express-mongoose/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Deepspace"><meta itemprop="description" content="凡事预 ？立 ：废"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Deepspace"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Express + Mongoose 实现增删改查</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-03-12 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-12T00:00:00+08:00">2017-03-12</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-11-07 17:31:58" itemprop="dateModified" datetime="2019-11-07T17:31:58+08:00">2019-11-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/NodeJS/" itemprop="url" rel="index"><span itemprop="name">NodeJS</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"> <p><code>Express</code> 是一个基于 <code>Node.js</code> 平台的极简、灵活的 web 应用开发框架，它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用，实现对数据库的增删查改。</p><p>数据库我们选择 <code>MongoDB</code>，它是一个基于分布式文件存储的开源数据库系统，<code>Mongoose</code> 是在 <code>node.js</code> 异步环境下对 <code>mongodb</code> 进行便捷操作的对象模型工具 。</p><p>接下来我们使用 <code>Express + Mongoose</code> 来实现简单的增删查改功能。</p><a id="more"></a><h3 id="一、创建一个-Express-项目"><a href="#一、创建一个-Express-项目" class="headerlink" title="一、创建一个 Express 项目"></a>一、创建一个 Express 项目</h3><p>既然 <code>Express</code> 是基于 <code>Node.js</code> 的框架，那么肯定需要装 <code>node.js</code> ，我们还需要安装 <code>MongoDB</code> , 关于 MongoDB 的使用，网上的教程有很多，我也写了一个基础的学习笔记，可以做下参考：<a href="http://www.togoblog.cn/mongodb-basic/" target="_blank" rel="noopener">MongoDB 学习笔记</a>。</p><p>接下来，我们使用 <code>express-generator</code> 来快速生成一个 <code>Express</code> 项目 :</p><pre><code>$ npm install -g express-generator
</code></pre><p>然后初始化一个文件名为 express-mongoose-demo 的项目 :</p><pre><code>$ express express-mongoose-demo
</code></pre><p>创建好项目之后，我们需要安装下依赖：</p><pre><code>$ cd express-mongoose-demo
$ npm install
</code></pre><p>启动项目：</p><pre><code>$ npm start
</code></pre><p>浏览器打开 <a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000</a> ，就可以看到已经可以访问了。</p><h3 id="二、介绍目录结构"><a href="#二、介绍目录结构" class="headerlink" title="二、介绍目录结构"></a>二、介绍目录结构</h3><pre><code>├─bin/      // 启动文件
├─public/   // 资源文件
├─routes/   // 路由
├─views/    // 视图
├─app.js
└─package.json
</code></pre><p>express 创建项目的目录结构还是比较明了的。下面我们详细看看。</p><h4 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h4><p><code>express</code> 创建的项目默认使用了 <code>jade</code> 模板引擎，在 <code>app.js</code> 中的设置的 ：</p><pre><code>// view engine setup
app.set(&#39;views&#39;, path.join(__dirname, &#39;views&#39;));
app.set(&#39;view engine&#39;, &#39;jade&#39;);
</code></pre><p><code>views/</code> 目录下都是 <code>.jade</code> 格式文件。简单说一下：</p><p>模板引擎（<code>Template Engine</code>）是一个将页面模板和数据结合起来生成 <code>html</code> 的工具。模板引擎有很多，在本学习笔记中，我们使用 <a href="https://www.npmjs.com/package/ejs" target="_blank" rel="noopener">ejs 模板引擎</a> ，先安装 ejs :</p><pre><code>$ npm install ejs --save
</code></pre><p>然后在 <code>app.js</code> 中将模板引擎修改成 ejs :</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> ejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// view engine setup</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'views'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">,</span> ejs<span class="token punctuation">.</span>__express<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><code>ejs</code> 有 3 种常用标签：</p><ul><li><code>&lt;% code %&gt;</code>：运行 <code>JavaScript</code> 代码，不输出</li><li><code>&lt;%= code %&gt;</code>：显示转义后的 <code>HTML</code> 内容</li><li><code>&lt;%- code %&gt;</code>：显示原始 <code>HTML</code> 内容</li></ul><p>更多使用方法这里不作详解！</p><h3 id="三、搭建视图和路由"><a href="#三、搭建视图和路由" class="headerlink" title="三、搭建视图和路由"></a>三、搭建视图和路由</h3><h4 id="创建用户列表"><a href="#创建用户列表" class="headerlink" title="创建用户列表"></a>创建用户列表</h4><p>把 <code>view/</code> 视图目录下的 <code>.jade</code> 文件都删除，然后创建 <code>UserList.html</code> 文件，内容如下：</p><pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>用户列表页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>用户名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>邮箱<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>操作<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">for(var</span> <span class="token attr-name">i</span> <span class="token attr-name">in</span> <span class="token attr-name">user){</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&lt;%= user[i].username %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&lt;%= user[i].email %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/users/detail/&lt;%<span class="token punctuation">=</span> user[i]._id %<span class="token punctuation">></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 查看 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/users/edit/&lt;%<span class="token punctuation">=</span> user[i]._id %<span class="token punctuation">></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 编辑 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>del<span class="token punctuation">"</span></span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%<span class="token punctuation">=</span> user[i]._id %<span class="token punctuation">></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 删除 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre><p>接下来实现上面视图对应的路由，项目中默认已经给我们生成了两个路由。在 <code>routes/</code> 路由目录下已经有了两个路由文件：<code>index.js</code> 和 <code>users.js</code>。</p><p>在 <code>app.js</code> 文件中，已经帮我们设置好了这两个路由：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> users <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>浏览器访问 <a href="http://localhost:3000/users" target="_blank" rel="noopener">http://localhost:3000/users</a> ，就能访问到 <code>users</code> 对应的页面。我们来看看路由里 <code>users.js</code> 是怎么写的：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/* GET users listing. */</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'respond with a resource'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre><p><code>express.Router</code> 类创建模块化、可挂载的路由句柄。我们修改上面代码来创建用户列表的路由 <code>users/list</code> :</p><pre class="language-javascript"><code class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> username<span class="token punctuation">:</span> <span class="token string">'Deepspace'</span><span class="token punctuation">,</span> email<span class="token punctuation">:</span> <span class="token string">'cxin1427@qq.com'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'UserList'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> list
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>还记得我们新建的 <code>UserList.html</code> 视图文件中的 <code>user</code> 变量吗，这里用到了 <code>res.render()</code> 方法，功能就是渲染视图模板。</p><p><code>res.render()</code> 方法接收两个参数：第一个参数为视图文件名，第二个参数是一个对象，用于向模板中传递数据，<code>user</code> 就是在这里传过去的。更改完路由之后我们重启服务器，访问 <a href="http://localhost:3000/users/list" target="_blank" rel="noopener">http://localhost:3000/users/list</a> 就可以看到用户列表页面了。</p><p><img src="https://raw.githubusercontent.com/IDeepspace/ImageHosting/master/NodeJS/express-2.png" alt="用户列表"></p><p>但是用户列表中的数据是写死的，我们应该从数据库中获取，下面我们来做这个工作。</p><h3 id="四、连接-MongoDB-数据库"><a href="#四、连接-MongoDB-数据库" class="headerlink" title="四、连接 MongoDB 数据库"></a>四、连接 MongoDB 数据库</h3><h4 id="1-新建-usersdb-数据库"><a href="#1-新建-usersdb-数据库" class="headerlink" title="1. 新建 usersdb 数据库"></a>1. 新建 usersdb 数据库</h4><pre><code>&gt; use usersdb
switch to db usersdb
</code></pre><h4 id="2-在项目中安装-Mongoose"><a href="#2-在项目中安装-Mongoose" class="headerlink" title="2. 在项目中安装 Mongoose"></a>2. 在项目中安装 Mongoose</h4><pre><code>$ npm install mongoose --save
</code></pre><p>安装成功后，就可以通过 <code>require(&#39;mongoose&#39;)</code> 来使用了！</p><h4 id="3-验证是否成功连接"><a href="#3-验证是否成功连接" class="headerlink" title="3. 验证是否成功连接"></a>3. 验证是否成功连接</h4><p>我们根目录下新建一个 <code>models</code> 目录，在此目录下创建一个 <code>db.js</code> 文件，内容如下：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  DB_URL <span class="token operator">=</span> <span class="token string">'mongodb://localhost:27017/usersdb'</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/*连接*/</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>DB_URL<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/*连接成功*/</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Mongoose connection open to '</span> <span class="token operator">+</span> DB_URL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/*连接异常*/</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Mongoose connection error: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/*连接断开*/</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'disconnected'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Mongoose connection disconnected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>然后，我们运行下 <code>db.js</code> :</p><pre class="language-javascript"><code class="language-javascript">$ node db<span class="token punctuation">.</span>js
</code></pre><p>从代码中可以看出，监听了几个事件，并且执行触发了<code>connected</code> 事件，打印：<code>Mongoose connection open to mongodb://localhost:27017/usersdb</code> 则表示连接成功！</p><h4 id="4-创建-Schema"><a href="#4-创建-Schema" class="headerlink" title="4. 创建 Schema"></a>4. 创建 Schema</h4><p><code>schema</code> 是 <code>mongoose</code> 里会用到的一种数据模式，可以理解为表结构的定义；每个 <code>schema</code> 会映射到 <code>mongodb</code> 中的一个 <code>collection</code>，它不具备操作数据库的能力 。</p><p>我们先改造一下 <code>db.js</code>，导出 <code>mongoose</code> 对象，在 <code>db.js</code> 文件最后一行添加如下代码即可：</p><pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> mongoose<span class="token punctuation">;</span>
</code></pre><p>下面我们定义一个 Schema，命名为 <code>userModel.js</code> , 内容如下：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./db.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span>

<span class="token keyword">var</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  username<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//用户名</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">//邮箱</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>定义一个 Schema 就这么简单，指定字段名和类型就可以了。</p><p><strong>Schema Types 内置类型如下：</strong></p><p><img src="https://raw.githubusercontent.com/IDeepspace/ImageHosting/master/NodeJS/Schema-Types.png" alt=""></p><h4 id="5-生成-Model"><a href="#5-生成-Model" class="headerlink" title="5. 生成 Model"></a>5. 生成 Model</h4><p>定义好了 Schema，接下就是生成 Model 。</p><p>这里的 <code>userSchema</code> 还不能对数据库进行操作，只是定义了数据模型属性 <code>username</code> , <code>email</code> 为字符串类型。需要将该 Schema 发布为 Model。<strong>Model 是由 Schema 发布生成的模型，可以对数据库的操作。</strong></p><pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="五、实现增删改查"><a href="#五、实现增删改查" class="headerlink" title="五、实现增删改查"></a>五、实现增删改查</h3><h4 id="1-查询"><a href="#1-查询" class="headerlink" title="1. 查询"></a>1. 查询</h4><p>在 <code>user.js</code> 路由文件里，我们来引入 <code>userModel.js</code> 进行数据库操作。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> userModel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../models/userModel.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  userModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'UserList'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      user<span class="token punctuation">:</span> data
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这里使用 <code>userModel.find()</code> <strong>查询</strong>到所有用户。但是现在我们的数据库里还是空的，我们来新增一个添加用户页面向数据库里插入数据。</p><h4 id="2-新增"><a href="#2-新增" class="headerlink" title="2. 新增"></a>2. 新增</h4><p>在 <code>views/</code> 目录下新建 <code>UserAdd.html</code>添加用户视图</p><pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;用户编辑页面&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action=&quot;/users/add&quot; method=&quot;post&quot;&gt;
        &lt;input type=&quot;text&quot; name=&quot;username&quot; value=&quot;&quot;&gt;
        &lt;input type=&quot;email&quot; name=&quot;email&quot; value=&quot;&quot;&gt;
        &lt;button type=&quot;submit&quot;&gt;submit&lt;/button&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;

</code></pre><p>在 <code>user.js</code> 路由文件里来添加对应视图的路由:</p><pre class="language-javascript"><code class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'UserAdd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这是渲染视图页面的路由，我们需要添加一个 post 方法的路由，在点击提交按钮的时候，把数据存进数据库里。</p><pre class="language-javascript"><code class="language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> newUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">userModel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>email
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  newUser<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/users/list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这里使用 <code>new userModel()</code> 创建了一个 <code>Entity</code>，它是由 <code>Model</code> 创建的实体，它的操作也会影响数据库。<code>newUser</code> 调用 <code>save()</code> 方法将数据保存到数据库中。然后 <code>res.redirect()</code> 将页面重定向到用户列表页面，这时就可以看到我们新增的用户显示在列表中了。接下来我们看看如何来编辑用户信息。</p><h4 id="3-修改"><a href="#3-修改" class="headerlink" title="3. 修改"></a>3. 修改</h4><p>依然是创建相应的用户编辑视图：UserEdit.html</p><pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>用户编辑页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/users/update<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%<span class="token punctuation">=</span> user._id %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%<span class="token punctuation">=</span> user.username %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%<span class="token punctuation">=</span> user.email %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>update<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre><p>添加对应的路由：<code>/users/edit/:id</code> 来渲染视图，<code>/users/update</code> 来修改数据库数据 :</p><pre class="language-javascript"><code class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/edit/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  userModel<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> id <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'UserEdit'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      user<span class="token punctuation">:</span> data
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/update'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  userModel<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    data<span class="token punctuation">.</span>username <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">;</span>
    data<span class="token punctuation">.</span>email <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>email<span class="token punctuation">;</span>
    data<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/users/list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><code>userModel.findOne()</code> 会根据查询条件 <code>{_id: id}</code> 查询到对应的一条数据，那么同理，查看用户详情的实现也是如此，只是渲染你到另外一个模板而已，这里就不重复写了；<code>userModel.findById()</code> 查询到 data 对象，该对象也属于 <code>Entity</code>，有 <code>save()</code> 操作。<code>req.body.username</code> 就可以获取到我们修改后的 <code>username</code>，修改 data 对象之后调用 <code>save()</code> 方法保存到数据库中。接下来看看如何删除用户吧。</p><h4 id="4-删除"><a href="#4-删除" class="headerlink" title="4. 删除"></a>4. 删除</h4><p>在用户列表中，点击删除按钮，就把该用户从数据库中给删除了，不需要视图，直接写路由。</p><pre class="language-javascript"><code class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">'/del'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  userModel<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> id <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> msg<span class="token punctuation">:</span> <span class="token string">'删除成功'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>点击按钮，发送删除的请求，那我们可以使用 ajax 来实现。在用户列表页面引入 jquery，方便我们操作。然后添加 ajax 请求.</p><pre class="language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.del'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token punctuation">:</span> <span class="token string">'/users/del?id='</span> <span class="token operator">+</span> id<span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'delete'</span><span class="token punctuation">,</span>
    success<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>重启服务器，进入 <code>users/list</code>，点击删除按钮，如果看到控制台中已经打印了 <code>{code: 200, msg: ‘删除成功’}</code> ，表示已经成功删除了，这时我们刷新页面，看看列表中已经不存在该用户了。</p><p><strong>部分路由对应的页面未创建视图或未做错误处理，但不影响学习本教程！</strong></p><h3 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h3><p>通过对用户的增删查改，学习如何写路由已经如何操作数据库。我们来总结一下：</p><ol><li>创建数据库，并验证是否正确连接</li><li>定义 Schema，由 Schema 发布 Model 来操作数据库。</li><li>Model 创建的实体 Entity，可以调用 save() 方法将数据保存到数据库中。</li><li><code>Model.find()</code> 方法查询到该 <code>Schema</code> 下的所有数据，<code>findOne()</code> 根据条件查询数据，<code>findById()</code> 根据 id 查询数据。</li><li>Model.remove() 删除数据。</li></ol><h3 id="代码地址"><a href="#代码地址" class="headerlink" title="代码地址"></a>代码地址</h3><blockquote><p><a href="https://github.com/IDeepspace/express-mongoose-demo-v1" target="_blank" rel="noopener">https://github.com/IDeepspace/express-mongoose-demo-v1</a></p></blockquote></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Express/" rel="tag"># Express</a> <a href="/tags/Mongoose/" rel="tag"># Mongoose</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/es6-arrow-functions/" rel="next" title="ES6 —— 箭头函数 Arrow Functions"><i class="fa fa-chevron-left"></i> ES6 —— 箭头函数 Arrow Functions</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/notes-with-gitbook/" rel="prev" title="如何使用 Gitbook 来做笔记?">如何使用 Gitbook 来做笔记?<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、创建一个-Express-项目"><span class="nav-number">1.</span> <span class="nav-text">一、创建一个 Express 项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、介绍目录结构"><span class="nav-number">2.</span> <span class="nav-text">二、介绍目录结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#app-js"><span class="nav-number">2.1.</span> <span class="nav-text">app.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、搭建视图和路由"><span class="nav-number">3.</span> <span class="nav-text">三、搭建视图和路由</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建用户列表"><span class="nav-number">3.1.</span> <span class="nav-text">创建用户列表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、连接-MongoDB-数据库"><span class="nav-number">4.</span> <span class="nav-text">四、连接 MongoDB 数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-新建-usersdb-数据库"><span class="nav-number">4.1.</span> <span class="nav-text">1. 新建 usersdb 数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-在项目中安装-Mongoose"><span class="nav-number">4.2.</span> <span class="nav-text">2. 在项目中安装 Mongoose</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-验证是否成功连接"><span class="nav-number">4.3.</span> <span class="nav-text">3. 验证是否成功连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-创建-Schema"><span class="nav-number">4.4.</span> <span class="nav-text">4. 创建 Schema</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-生成-Model"><span class="nav-number">4.5.</span> <span class="nav-text">5. 生成 Model</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#五、实现增删改查"><span class="nav-number">5.</span> <span class="nav-text">五、实现增删改查</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-查询"><span class="nav-number">5.1.</span> <span class="nav-text">1. 查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-新增"><span class="nav-number">5.2.</span> <span class="nav-text">2. 新增</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-修改"><span class="nav-number">5.3.</span> <span class="nav-text">3. 修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-删除"><span class="nav-number">5.4.</span> <span class="nav-text">4. 删除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#六、总结"><span class="nav-number">6.</span> <span class="nav-text">六、总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代码地址"><span class="nav-number">7.</span> <span class="nav-text">代码地址</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Deepspace" src="/images/avatar.gif"><p class="site-author-name" itemprop="name">Deepspace</p><div class="site-description" itemprop="description">凡事预 ？立 ：废</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">45</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">36</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2019</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Deepspace</span></div><div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://pisces.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.5.0</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script></body></html>