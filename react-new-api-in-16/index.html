<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.8.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="alternate" href="/atom.xml" title="Deepspace" type="application/atom+xml"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"7.5.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"复制",copy_success:"复制成功",copy_failure:"复制失败"},sidebarPadding:40}</script><meta name="description" content="对于 React v16 之后版本中的一些新特性，挑选了以下几个常用的 Api 来讲解 :  Render 方法优化 错误边界 Portals Context API 新的生命周期  后面会持续更新。 一、Render 方法优化为了符合 React 的 component tree 和 diff 结构设计，在组件的 render  方法中，顶层必须包裹为单节点，因此我们在实际组件的设计和使用中，"><meta name="keywords" content="React,Portals,ErrorBoundary"><meta property="og:type" content="article"><meta property="og:title" content="React 16 中的新特性"><meta property="og:url" content="https://togoblog.cn/react-new-api-in-16/index.html"><meta property="og:site_name" content="Deepspace"><meta property="og:description" content="对于 React v16 之后版本中的一些新特性，挑选了以下几个常用的 Api 来讲解 :  Render 方法优化 错误边界 Portals Context API 新的生命周期  后面会持续更新。 一、Render 方法优化为了符合 React 的 component tree 和 diff 结构设计，在组件的 render  方法中，顶层必须包裹为单节点，因此我们在实际组件的设计和使用中，"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://raw.githubusercontent.com/IDeepspace/ImageHosting/master/React/react15-lifecycle.png"><meta property="og:image" content="https://raw.githubusercontent.com/IDeepspace/ImageHosting/master/React/reactv16.4-lifecycle.jpg"><meta property="og:updated_time" content="2019-11-07T09:31:58.261Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="React 16 中的新特性"><meta name="twitter:description" content="对于 React v16 之后版本中的一些新特性，挑选了以下几个常用的 Api 来讲解 :  Render 方法优化 错误边界 Portals Context API 新的生命周期  后面会持续更新。 一、Render 方法优化为了符合 React 的 component tree 和 diff 结构设计，在组件的 render  方法中，顶层必须包裹为单节点，因此我们在实际组件的设计和使用中，"><meta name="twitter:image" content="https://raw.githubusercontent.com/IDeepspace/ImageHosting/master/React/react15-lifecycle.png"><link rel="canonical" href="https://togoblog.cn/react-new-api-in-16/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>React 16 中的新特性 | Deepspace</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Deepspace</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">我叫陈星星</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li></ul></nav></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://togoblog.cn/react-new-api-in-16/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Deepspace"><meta itemprop="description" content="凡事预 ？立 ：废"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Deepspace"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> React 16 中的新特性</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-03-23 00:00:00" itemprop="dateCreated datePublished" datetime="2019-03-23T00:00:00+08:00">2019-03-23</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-11-07 17:31:58" itemprop="dateModified" datetime="2019-11-07T17:31:58+08:00">2019-11-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"> <p>对于 <code>React v16</code> 之后版本中的一些新特性，挑选了以下几个常用的 <code>Api</code> 来讲解 :</p><ul><li>Render 方法优化</li><li>错误边界</li><li>Portals</li><li>Context API</li><li>新的生命周期</li></ul><p>后面会持续更新。</p><h3 id="一、Render-方法优化"><a href="#一、Render-方法优化" class="headerlink" title="一、Render 方法优化"></a>一、Render 方法优化</h3><p>为了符合 <code>React</code> 的 <code>component tree</code> 和 <code>diff</code> 结构设计，在组件的 <code>render</code> 方法中，顶层必须包裹为单节点，因此我们在实际组件的设计和使用中，需要注意尽量避免嵌套后的层级变深。<br><a id="more"></a><br>比如下面的内容结构就必须再嵌套一个 <code>div</code> 使其变成单节点再返回：</p><pre class="language-jsx"><code class="language-jsx"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>one<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>two<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>three<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><code>React v16</code> 之后，这个问题得到了改进，<code>render</code> 方法支持返回数组和字符串了:</p><pre class="language-jsx"><code class="language-jsx"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token string">'One'</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token string">'1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token string">'Two'</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token string">'Three'</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token string">'3'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Don't forget the keys :)</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>key<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>支持返回数组之后，有时候我们的代码可能长成下面这个样子：</p><pre class="language-jsx"><code class="language-jsx"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token punctuation">[</span>
     <span class="token string">"Some text."</span><span class="token punctuation">,</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>heading-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>A heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
     <span class="token string">"More text."</span><span class="token punctuation">,</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>heading-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Another heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
     <span class="token string">"Even more text."</span>
   <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>虽然减少了一层嵌套，但是代码看上去不简洁：</p><ul><li>数组中的元素必须以逗号分隔；</li><li>数组中的子节点都必须添加一个 <code>key</code> 属性来避免 <code>React</code> 的警告；</li><li>字符串必须用引号括起来。</li></ul><p>所以，在 <code>React v16.2</code> 中，官方又推出了 <code>Fragment</code> 组件来代替直接 <code>render</code> 数组的方式：</p><pre class="language-jsx"><code class="language-jsx"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Fragment</span><span class="token punctuation">></span></span>
      Some text<span class="token punctuation">.</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>A heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
      More text<span class="token punctuation">.</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Another heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
      Even more text<span class="token punctuation">.</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Fragment</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><code>Fragment</code> 虽然也是一个正常单节点写法，直接包裹里面的内容。但是 <code>Fragment</code> 本身并不会产生真实的 <code>DOM</code> 节点，因此也不会导致层级嵌套增加。<code>Fragment</code> 组件也提供了简写的方式：</p><pre class="language-jsx"><code class="language-jsx"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      Some text<span class="token punctuation">.</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>A heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
      More text<span class="token punctuation">.</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Another heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
      Even more text<span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>如果需要给 <code>Fragment</code> 添加 <code>key</code> 属性，是不支持使用简写的。（这也是 <code>Fragment</code> 唯一会遇到需要添加 <code>props</code> 的情况：</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Glossary</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">></span></span>
      <span class="token punctuation">{</span>props<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>
        <span class="token comment" spellcheck="true">// Without the `key`, React will fire a key warning</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Fragment</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>term<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>description<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Fragment</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="二、错误边界"><a href="#二、错误边界" class="headerlink" title="二、错误边界"></a>二、错误边界</h3><p><code>UI</code> 部分的一个 <code>JavaScript</code> 错误不应该破坏整个程序。为了解决这个问题，<code>React v16</code> 引入了<strong>错误边界</strong>的新概念。</p><p>错误边界是<strong>用于捕获其子组件树 <code>JavaScript</code> 异常，记录错误并展示一个回退的 UI</strong> 的 <code>React</code> 组件，而不是整个组件树的异常。错误边界在渲染期间、生命周期方法内、以及整个组件树构造函数内捕获错误。</p><p>下面的例子是通过一个 <code>ErrorBoundary</code> 组件对其内的内容进行保护和错误捕捉，并在发生错误时进行回退的UI展示：</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> errorInfo<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Catch errors in any components below and re-render with error message</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      error<span class="token punctuation">:</span> error<span class="token punctuation">,</span>
      errorInfo<span class="token punctuation">:</span> errorInfo<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// You can also log error messages to an error reporting service here</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>errorInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Error path</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Something went wrong<span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> whiteSpace<span class="token punctuation">:</span> <span class="token string">'pre-wrap'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
            <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>error <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>error<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
            <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>errorInfo<span class="token punctuation">.</span>componentStack<span class="token punctuation">}</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// Normally, just render children</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>然后我们就可以像一个普通的组件一样使用：</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">BuggyCounter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> counter<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> counter <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      counter<span class="token punctuation">:</span> counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">===</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Simulate a JS error</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'I crashed!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ErrorBoundary</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>
          These two counters are inside the same error boundary<span class="token punctuation">.</span> If one crashes<span class="token punctuation">,</span>
          the error boundary will replace both <span class="token keyword">of</span> them<span class="token punctuation">.</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BuggyCounter</span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BuggyCounter</span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ErrorBoundary</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>
        These two counters are each inside <span class="token keyword">of</span> their own error boundary<span class="token punctuation">.</span> So <span class="token keyword">if</span>
        one crashes<span class="token punctuation">,</span> the other is not affected<span class="token punctuation">.</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ErrorBoundary</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BuggyCounter</span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ErrorBoundary</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ErrorBoundary</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BuggyCounter</span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ErrorBoundary</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>错误边界工作机制类似于 <code>JavaScript</code> 中的 <code>catch {}</code> 。注意：仅有类组件可以成为错误边界。</p><p>在实际开发中，大多数情况下，我们可以只定义一个错误边界组件，并将它贯穿整个应用。</p><blockquote><p>注意：错误边界<strong>无法</strong>捕获如下错误:</p><ul><li>事件处理 （<a href="https://reactjs.org/docs/error-boundaries.html#how-about-event-handlers" target="_blank" rel="noopener">了解更多</a>）</li><li>异步代码 （例如 <code>setTimeout</code> 或 <code>requestAnimationFrame</code> 回调函数）</li><li>服务端渲染</li><li>错误边界自身抛出来的错误 （而不是其子组件）</li></ul></blockquote><h3 id="三、Portals"><a href="#三、Portals" class="headerlink" title="三、Portals"></a>三、Portals</h3><p><code>createPortal</code> 这个 <code>Api</code> 用于将子节点渲染到父组件以外的 <code>DOM</code> 节点上。<code>createPortal</code> 的出现为弹窗、对话框等脱离文档流的组件开发提供了很大的便利。</p><p>现在我们来想一下，如果需要显示一个对话框(<code>Dialog</code>)，该怎么做呢？</p><p>最直观的做法，就是直接在 <code>JSX</code> 中把 <code>Dialog</code> 画出来，像下面代码的样子：</p><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span> <span class="token operator">...</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
   <span class="token punctuation">{</span> needDialog <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Dialog</span> <span class="token punctuation">/></span></span> <span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre><p>那么这样就有一个问题：这样渲染的话，<code>Dialog</code> 最终渲染产生的 <code>HTML</code> 就和上面非 <code>Dialog</code> 内容的 <code>JSX</code> 产生的<code>HTML</code> 混在一起了，像下面这样：</p><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span> <span class="token operator">...</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Dialog Content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre><p>而对于对话框，从用户的感知角度来说，它应该是一个独立的组件。</p><p>但是现在 <code>Dialog</code> 被包在其他组件中，那就要用 <code>CSS</code> 的 <code>position</code> 属性控制 <code>Dialog</code> 位置了，就要求从 <code>Dialog</code> 往上一直到 <code>body</code> ，没有其他 <code>position</code> 是 <code>relative</code> 的元素的干扰，显然这是比较麻烦的。同时， <code>Dialog</code> 的样式也会与其它组件混在一起。</p><p>解决这个问题，我们可以在 <code>React</code> 组件树的最顶层创建一个专属于 <code>Dialog</code> 的元素，然后通过 <code>Redux</code> 或者其他什么通讯方式给这个 <code>Dialog</code> 发送信号，来控制 <code>Dialog</code> 显示或者不显示。但是这样又会造成 “杀鸡焉用牛刀” 的问题：我们只是为了一个 <code>Dialog</code> 却引入了 <code>Redux</code> 。</p><p>在 <code>React 16</code> 之前，也有实现 “传送门” 的方式，但是官方一直并不鼓励使用，所以这里也不作深入讨论。<code>React 16</code> 后，使用 <code>createPortal Api</code> 创建 <code>Dialog</code> 组件就简单多了，不需要牵扯到 <code>componentDidMount</code>、<code>componentDidUpdate</code> 等生命周期问题，也不用调用 <code>API</code> 清理 <code>Portal</code>，关键代码在 <code>render</code> 中，我们看一下 <a href="https://codepen.io/gaearon/pen/yzMaBd" target="_blank" rel="noopener">官方给的 <code>demo</code></a> :</p><p>首先在 <code>public/index.html</code> 中新建一个根节点：</p><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modal-root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
</code></pre><p>通过 <code>createPortal Api</code> 创建一个 “传送门”：</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> modalRoot <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'modal-root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Modal</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Create a div that we'll render the modal into. Because each</span>
    <span class="token comment" spellcheck="true">// Modal component has its own element, we can render multiple</span>
    <span class="token comment" spellcheck="true">// modal components into the modal container.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Append the element into the DOM on mount. We'll render</span>
    <span class="token comment" spellcheck="true">// into the modal container element (see the HTML tab).</span>
    modalRoot<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Remove the element from the DOM when we unmount</span>
    modalRoot<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Use a portal to render the children into the element</span>
    <span class="token keyword">return</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>
      <span class="token comment" spellcheck="true">// Any valid React child: JSX, strings, arrays, etc.</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
      <span class="token comment" spellcheck="true">// A DOM element</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Modal<span class="token punctuation">;</span>
</code></pre><p>使用 <code>Modal</code> :</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Modal <span class="token keyword">from</span> <span class="token string">'./Modal'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./style.css'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> showModal<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> clicks<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  handleShow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showModal<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  handleHide <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showModal<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  handleClick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// This will fire when the button in Child is clicked,</span>
    <span class="token comment" spellcheck="true">// updating Parent's state, even though button</span>
    <span class="token comment" spellcheck="true">// is not direct descendant in the DOM.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>prevState <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      clicks<span class="token punctuation">:</span> prevState<span class="token punctuation">.</span>clicks <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Show a Modal on click.</span>
    <span class="token comment" spellcheck="true">// (In a real app, don't forget to use ARIA attributes</span>
    <span class="token comment" spellcheck="true">// for accessibility!)</span>
    <span class="token keyword">const</span> modal <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>showModal <span class="token operator">?</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Modal</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>modal<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleHide<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>Hide modal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>Click<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Modal</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Number <span class="token keyword">of</span> clicks<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>clicks<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        This div has overflow<span class="token punctuation">:</span> hidden<span class="token punctuation">.</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleShow<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>Show modal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token punctuation">{</span>modal<span class="token punctuation">}</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre><p>上面的代码中，<code>App</code> 组件通过 <code>Portal</code> 把里面的内容渲染到了一个独立的节点上，在实际的 <code>DOM</code> 结构中，<code>modal</code> 里面的内容已经脱离了 <code>App</code> 组件本身的 <code>DOM</code> 树而存在于另一个独立节点。对于要通过 <code>createPortal()</code> “分离” 出去的内容，它的数据传递，生命周期，甚至事件冒泡，依然存在于原本的抽象组件树结构当中。这里实际依赖于 <code>React</code> 代理和重写了整套事件系统，让整个抽象组件树的逻辑得以保持同步。</p><p>运行上面的代码可以查看效果。</p><h3 id="四、Context-API"><a href="#四、Context-API" class="headerlink" title="四、Context API"></a>四、Context API</h3><p>参考：<a href="https://togoblog.cn/react-component-communication/#toc-heading-5">https://togoblog.cn/react-component-communication/#toc-heading-5</a></p><h3 id="五、新的生命周期"><a href="#五、新的生命周期" class="headerlink" title="五、新的生命周期"></a>五、新的生命周期</h3><h4 id="旧的生命周期"><a href="#旧的生命周期" class="headerlink" title="旧的生命周期"></a>旧的生命周期</h4><p>我们先看看 <code>React 16</code> 之前的生命周期图：</p><p><img src="https://raw.githubusercontent.com/IDeepspace/ImageHosting/master/React/react15-lifecycle.png" alt="Reactv15生命周期图"></p><p>如上图所示，可以把组件的生命周期大致分为三个阶段：</p><ul><li>挂载阶段 (Mount)</li><li>更新阶段 (Update)</li><li>卸载阶段 (Unmount)</li></ul><h5 id="挂载阶段"><a href="#挂载阶段" class="headerlink" title="挂载阶段"></a>挂载阶段</h5><p><strong>constructor()</strong></p><pre><code>挂载之前调用一次，可以初始化state
</code></pre><p><strong>getDefaultProps()</strong></p><pre><code>设置默认的 props ，也可以用 dufaultProps 设置组件的默认属性。
</code></pre><p><strong>getInitialState()</strong></p><pre><code>初始化 state，可以直接在 constructor 中定义 this.state
</code></pre><p><strong>componentWillMount()</strong></p><pre><code>componentWillMount 会在组件 render 之前执行，并且永远都只执行一次。

componentWillMount 和挂载是同步执行的，意味着执行完这个钩子，立即挂载。

由于这个方法始终只执行一次，所以如果在这里定义了 setState 方法之后，页面永远都只会在加载前更新一次。
</code></pre><p><strong>render()</strong></p><pre><code>react 最重要的步骤，创建虚拟 dom，进行 diff 算法，更新 dom 树都在此进行
</code></pre><p><strong>componentDidMount()</strong></p><pre><code>这个方法会在组件加载完毕之后立即执行。在这个时候之后组件已经生成了对应的 DOM 结构，可以通过 this.getDOMNode() 来进行访问。

如果你想和其他 JavaScript 框架一起使用，可以在这个方法中执行 setTimeout, setInterval 或者发送 AJAX 请求等操作(防止异部操作阻塞UI)。
</code></pre><h5 id="更新阶段"><a href="#更新阶段" class="headerlink" title="更新阶段"></a>更新阶段</h5><p><strong>componentWillReceivePorps(nextProps)</strong></p><pre><code>在组件接收到一个新的 prop 时被执行。这个方法在初始化 render 时不会被调用。
</code></pre><p><strong>shouldComponentUpdate(nextProps, nextState)</strong></p><pre><code>组件接收到新的 props 或者 state 时调用，在初始化时或者使用 forceUpdate 时不被执行。return true 就会更新 dom（使用diff算法更新），return false 能阻止更新（不调用render）。

可以在你确认不需要更新组件时使用，提升性能。
</code></pre><p><strong>componentWillUpdata(nextProps, nextState)</strong></p><pre><code>组件挂载时不调用，只有在组件将要更新时才调用。

shouldComponentUpdate 生命周期钩子返回 true，或者调用 this.forceUpdate 之后，会立即执行该生命周期钩子。

要特别注意，componentWillUpdate 生命周期钩子每次更新前都会执行，所以在这里调用 this.setState 非常危险，有可能会没完没了。
</code></pre><p><strong>render()</strong></p><pre><code>react 最重要的步骤，创建虚拟 dom，进行 diff 算法，更新 dom 树都在此进行
</code></pre><p><strong>componentDidUpdate(nextProps, nextState, snapshot)</strong></p><pre><code>这是组件更新之后触发的生命周期钩子。

componentDidUpdate 生命周期钩子每次更新后都会执行，所以在这里调用 this.setState 也非常危险，有可能会没完没了。

搭配 getSnapshotBeforeUpdate 生命周期钩子(React 16 中的新生命周期)使用的时候，第三个参数是 getSnapshotBeforeUpdate 的返回值。
</code></pre><h5 id="卸载阶段"><a href="#卸载阶段" class="headerlink" title="卸载阶段"></a>卸载阶段</h5><p><strong>componentWillUnmount()</strong></p><pre><code>组件渲染之后，卸载之前的生命周期钩子，只调用一次。

React的最佳实践是，组件中用到的事件监听器、订阅器、定时器都要在这里销毁。

事件监听指的是下面这种情况：
componentDidMount() {
    document.addEventListener(&#39;click&#39;, () =&gt; {});
}

下面这种 React 会自动销毁
render(
    return (
        &lt;button onClick={this.handleClick}&gt;click&lt;/button&gt;
    );
)
</code></pre><h4 id="新的生命周期"><a href="#新的生命周期" class="headerlink" title="新的生命周期"></a>新的生命周期</h4><p>再来看下 <code>React v16.4</code> 的生命周期图：</p><p><img src="https://raw.githubusercontent.com/IDeepspace/ImageHosting/master/React/reactv16.4-lifecycle.jpg" alt="Reactv16.4生命周期图"></p><p><code>React16</code> 废弃的三个生命周期函数：</p><ul><li><p>componentWillMount</p></li><li><p>componentWillReceiveProps</p></li><li><p>componentWillUpdate</p><p>目前在 <code>React 16</code> 版本中，官方并未完全删除这三个函数，而且新增了<code>UNSAFE_componentWillMount</code>， <code>UNSAFE_componentWillReceiveProps</code>，<code>UNSAFE_componentWillUpdate</code>三个函数，计划在 <code>React 17</code> 的版本中移除掉这三个函数，目的是为了做向下兼容，为什么会移除这三个生命周期函数呢？</p></li></ul><p><strong>componentWillMount</strong></p><pre><code>很多人会有一个误区：这个钩子是请求数据然后将数据插入元素一同挂载的最佳时机。

其实 componentWillMount 和挂载是同步执行的，意味着执行完这个钩子，立即挂载。而向服务器请求数据是异步执行的。所以无论请求多么快，都要排在同步任务之后再处理。也就是说，永远不可能在这里将数据插入元素一同挂载。

并不是说不能在这里请求数据，而是达不到你臆想的效果。

它被废弃的原因主要有：

- 。
- 如果它声明了定时器或者订阅器，在服务端渲染中，componentWillUnmount 生命周期钩子中的清除代码不会生效。因为如果组件没有挂载成功，componentWillUnmount 是不会执行的。没有挂载就没有卸载。
- 在异步渲染中，它的表现不稳定。

初始化 this.state 应该在 constructor 生命周期钩子中完成，请求数据应该在 componentDidMount 生命周期钩子中完成，所以本来它就没什么用。可能当初创造它是为了成双成对吧，所以才被完全废弃了。
</code></pre><p><strong>componentWillReceiveProps</strong></p><pre><code>componentWillReceiveProps 生命周期钩子只有一个参数，更新后的 props。

该声明周期函数可能在两种情况下被触发：

- 组件接收到了新的属性。
- 组件没有收到新的属性，但是由于父组件重新渲染导致当前组件也被重新渲染。

初始化时并不会触发该生命周期钩子。

因为 Fiber 机制的引入，这个生命周期钩子有可能会多次触发。
</code></pre><p><strong>componentWillUpdate</strong></p><pre><code>shouldComponentUpdate 生命周期钩子返回 true，或者调用 this.forceUpdate 之后，会立即执行该生命周期钩子。

要特别注意，componentWillUpdate 生命周期钩子每次更新前都会执行，所以在这里调用 this.setState 非常危险，有可能会没完没了。

同样，因为Fiber机制的引入，这个生命周期钩子有可能会多次调用。
</code></pre><p>新增加了两个新的生命周期函数</p><ul><li>static getDerivedStateFromProps</li><li>getSnapshotBeforeUpdate</li></ul><h5 id="getDerivedStateFromProps"><a href="#getDerivedStateFromProps" class="headerlink" title="getDerivedStateFromProps"></a>getDerivedStateFromProps</h5><pre><code>static getDerivedStateFromProps(nextProps, prevState)，它是一个静态方法，所以不能再这个函数里面使用 this；

这个函数有两个参数： props 和 state，分别指接收到的新参数和当前的 state 对象；

该函数会返回一个对象用来更新当前的 state 对象，如果不需要更新状态可以返回 null 来表明不需要更新任何状态；

该函数会在挂载时，接收到新的 props，调用了 setState 和 forceUpdate 时被调用，简单点说就是：getDerivedStateFromProps 无论是在挂载阶段还是更新阶段，也无论是什么引起的更新，统统都会被调用，在首次渲染的时候也会被触发 (注意：v16.3 中，setState 时、forceUpdate 时不会执行这个方法，v16.4 修复了这个问题)。

和 componentWillReceiveProps 不同，componentWillReceiveProps 只在父组件引起的更新时才会触发。
</code></pre><p>一个简单的例子：</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      counter<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// componentWillReceiveProps(nextProps) {</span>
  <span class="token comment" spellcheck="true">//   console.log('Running A.componentWillReceiveProps()');</span>
  <span class="token comment" spellcheck="true">// }</span>

  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span> prevState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Being called'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>name <span class="token operator">!==</span> prevState<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Running A.getDerivedStateFromProps()'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> nextProps<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  handleClick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> counter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      counter<span class="token punctuation">:</span> counter<span class="token operator">++</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A.render()'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Hello <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> counter<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>A</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>World<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        counter<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> B<span class="token punctuation">;</span>
</code></pre><p><code>getDerivedStateFromProps</code> 是用来替代 <code>componentWillReceiveProps</code> 的，应对 <code>state</code> 需要关联 <code>props</code> 变化的场景。它的作用就是让组件根据父组件传来的 <code>props</code>，判断是否需要更新自己的 <code>state</code> ，这种state叫做衍生state。返回的对象就是要增量更新的state。</p><p>将 <code>getDerivedStateFromProps</code> 设计成静态函数，目的是保持该方法的纯粹，它就是用来定义衍生state的，能做的操作局限在根据 <code>props</code> 和 <code>state</code> 决定新的 <code>state</code>，除此之外不应该在里面执行任何操作。</p><p>一般使用场景如下：</p><ol><li>无条件的根据 <code>props</code> 更新 <code>state</code></li><li>当 <code>props</code> 和 <code>state</code> 的不匹配情况更新 <code>state</code></li></ol><h5 id="getSnapshotBeforeUpdate"><a href="#getSnapshotBeforeUpdate" class="headerlink" title="getSnapshotBeforeUpdate"></a>getSnapshotBeforeUpdate</h5><pre><code>顾名思义，保存状态快照用的。

它会在组件即将挂载时调用，注意，是即将挂载。它甚至调用的比 render 还晚，由此可见 render 并没有完成挂载操作，而是进行构建抽象 UI 的工作。getSnapshotBeforeUpdate 执行完就会立即调用 componentDidUpdate 生命周期钩子。

它是做什么用的呢？有一些状态，比如网页滚动位置，不需要它持久化，只需要在组件更新以后能够恢复原来的位置即可。

getSnapshotBeforeUpdate 生命周期钩子返回的值会被 componentDidUpdate 的第三个参数接收，我们可以利用这个通道保存一些不需要持久化的状态，用完即可舍弃。

很显然，它是用来取代 componentWillUpdate 生命周期钩子的。

意思就是说呀，开发者一般用不到它。
</code></pre><blockquote><p>本篇内容代码：<a href="https://github.com/IDeepspace/React-Workshop/tree/master/react-16-api" target="_blank" rel="noopener">https://github.com/IDeepspace/React-Workshop/tree/master/react-16-api</a></p></blockquote></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/React/" rel="tag"># React</a> <a href="/tags/Portals/" rel="tag"># Portals</a> <a href="/tags/ErrorBoundary/" rel="tag"># ErrorBoundary</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/javascript-tricks/" rel="next" title="一些比较有用的 JS 技巧"><i class="fa fa-chevron-left"></i> 一些比较有用的 JS 技巧</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/react-hook/" rel="prev" title="React v16.8 Hook 功能">React v16.8 Hook 功能<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、Render-方法优化"><span class="nav-number">1.</span> <span class="nav-text">一、Render 方法优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、错误边界"><span class="nav-number">2.</span> <span class="nav-text">二、错误边界</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、Portals"><span class="nav-number">3.</span> <span class="nav-text">三、Portals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、Context-API"><span class="nav-number">4.</span> <span class="nav-text">四、Context API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#五、新的生命周期"><span class="nav-number">5.</span> <span class="nav-text">五、新的生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#旧的生命周期"><span class="nav-number">5.1.</span> <span class="nav-text">旧的生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#挂载阶段"><span class="nav-number">5.1.1.</span> <span class="nav-text">挂载阶段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#更新阶段"><span class="nav-number">5.1.2.</span> <span class="nav-text">更新阶段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#卸载阶段"><span class="nav-number">5.1.3.</span> <span class="nav-text">卸载阶段</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#新的生命周期"><span class="nav-number">5.2.</span> <span class="nav-text">新的生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#getDerivedStateFromProps"><span class="nav-number">5.2.1.</span> <span class="nav-text">getDerivedStateFromProps</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#getSnapshotBeforeUpdate"><span class="nav-number">5.2.2.</span> <span class="nav-text">getSnapshotBeforeUpdate</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Deepspace" src="/images/avatar.gif"><p class="site-author-name" itemprop="name">Deepspace</p><div class="site-description" itemprop="description">凡事预 ？立 ：废</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">45</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">36</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2019</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Deepspace</span></div><div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://pisces.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.5.0</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script></body></html>